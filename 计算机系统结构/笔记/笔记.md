# 计算机系统结构的基础知识
## Amdahl定律

**加速比**
$加速比=\frac{系统性能_{改进后}}{系统性能_{改进前}}=\frac{总执行时间_{改进前}}{总执行时间_{改进后}}$
$S_n=\frac{T_0}{T_n}=\frac1{1-Fe+\frac{Fe}{Se}}$

**可改进比例**
$Fe=\frac{改进前可改进部分的执行时间}{改进前总的执行时间}$

**部件加速比**
$Se=\frac{改进部分改进前执行时间}{改进部分改进后执行时间}$

## CPU性能公式

$CPI_i$ ：第i种指令周期所需的平均周期数
$IC_i$ ：第i种指令出现的次数
$IC$ ：所执行的指令总条数
$CPI$：每条指令的平均周期数
$MIPs$：每秒执行的百万条指令数

$CPU时间周期数=\sum\limits_{i=1}^n(CPI_i\times IC_i)$
$CPU时间=CPI时间周期数\times 时钟周期时间$
$CPI=\frac{CPU时间周期数}{IC}$
$MIPs=\frac{IC}{程序执行时间\times10^6}=\frac{主频}{CPI\times10^6}$

# 指令系统结构的设计
## 指令操作码的优化
1. 赫夫曼编码
2. 等长扩展码（3/3/3、2/7……）
3. 定长操作码

# 流水线技术
## 流水线的性能指标
$T_{pipeline}=\sum\limits_{i=1}^{k}\Delta t_i+(n-1)max(\Delta t_1,\Delta t_2,\cdots,\Delta t_k)$
实际吞吐率：$TP=\frac n{T_{pipeline}}=\frac{结果数}{流水线时间}$
最大吞吐率：$TP_{max}=\frac1{max(\Delta t_1,\Delta t_2,\cdots,\Delta t_k)}$
加速比：$S=\frac{n\sum\limits_{i=1}^k\Delta t_i}{T_{pipeline}}$
效率：$E=\frac{n\sum\limits_{i=1}^k\Delta t_i}{k\,T_{pipeline}}=\frac{阴影面积}{总矩形面积}$
## 非线性流水线的最优调度
1. 根据预约表写出禁止表$F$
2. 根据禁止表写出初始冲突向量$C_0$
3. 根据初始冲突向量$C_0$画出状态转换图
$C_{new}=SHR^{(j)}(C_k)~XOR~(C_0)$
4. 根据状态转换图写出最优调度方案

## 流水线的相关与冲突
### 五段流水线
1. 取指令周期IF
2. 指令译码/读寄存器周期ID
3. 执行/有效地址计算周期EX
4. 存储器访问/分支完成周期MEM
5. 写回周期WB
### 相关与流水线冲突
#### 相关
1. 数据相关
   一读一写，且有传递性
2. 名相关
   1. 反相关
    读名相同
   2. 输出相关
    写名相同
3. 控制相关
    跟分支有关

#### 流水线冲突
##### 结构冲突
##### 数据冲突
分类
写后读RAW：真数据相关
写后写WAW：输出相关
读后写WAR：反相关

解决方式
定向技术、指令调度

##### 控制冲突
解决方式：冻结、排空、预测分支、延迟分支